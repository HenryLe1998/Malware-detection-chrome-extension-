document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('uploadForm');

    const sendFiles = async () => {
        const myFiles = document.getElementById('myFiles').files;
        const formData = new FormData();

        Object.keys(myFiles).forEach(key => {
            formData.append(myFiles.item(key).name, myFiles.item(key));
        });

        chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
            const activeTab = tabs[0];
            const tabURL = activeTab.url;

            fetch(tabURL, {
                method: 'POST',
                body: formData,
            })
                .then((response) => response.json())
                .then((json) => {
                    const h2 = document.querySelector('h2');
                    h2.textContent = `Status: ${json?.status}`;

                    const h3 = document.querySelector('h3');
                    h3.textContent = json?.message;

                    console.log(json);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        });
    };

    form.addEventListener('submit', (e) => {
        e.preventDefault();
        sendFiles();
    });
});
